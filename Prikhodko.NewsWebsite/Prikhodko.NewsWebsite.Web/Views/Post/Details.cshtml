@model Prikhodko.NewsWebsite.Web.Models.PostViewModel

<div class="container">

    <h1>@Model.Title</h1>

    <div class="container">

        <div class="col-md-10">
            <h4>@Model.Description</h4>
        </div>

        <div class="col-md-2">
            Category:
            @Html.DisplayFor(model => model.Category)
        </div>
    </div>

    <div class="panel panel-default">
        @Html.Raw(Model.Content)
    </div>

    <div class="container">
        <div class="col-md-8">
            @foreach (var tag in Model.Tags)
            {
                <a href="#">@tag</a>;
            }
        </div>
        <div class="col-md-2">
            @if (Model.RatedByCurrentUser)
            {
                <div>Your rate:</div>
            }

            <div class="content-rate"></div>
            <div>Average rate: @Model.AvgRate</div>
        </div>
        <div>
            By:
            @Html.ActionLink((string)ViewBag.Author.ApplicationIdentityUser.UserName, "Details", "Account")
        </div>
    </div>

</div>

@section Scripts {
    <script src="~/Scripts/rater.min.js"></script>

    <script>
        if ('@ViewBag.UserAuthenticated' === 'True') {
            var rate_value = '@Model.CurrentUserRateValue';
            var options = {
                max_value: 5,
                initial_value: rate_value.replace(",", "."),
                readonly: ('@Model.RatedByCurrentUser' === 'True'), //TODO: this is very unoptimized but js compares C# booleans as strings so I do not know the way around
                step_size: 0.5
            }

            $(".content-rate").rate(options);
            $(".content-rate").on("change",
                function (ev, data) {
                    options = {
                        max_value: 5,
                        initial_value: 0,
                        readonly: true,
                        step_size: 0.5
                    }
                    $(".content-rate").rate("destroy");
                    $(".content-rate").rate(options);

                    $.ajax({
                        url: "/Post/AddRate",
                        data: { rate: data.to, postId: @Model.Id }
                    });
                });
        }
    </script>

}