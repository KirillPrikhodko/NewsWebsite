@model IEnumerable<Prikhodko.NewsWebsite.Service.Contracts.Models.UserServiceModel>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="https://www.w3schools.com/lib/w3.js"></script>

<table id="users" style="margin-top: 15px" class="w3-table-all">
    <tr>
        <th onclick="w3.sortHTML('#posts', '.item', 'td:nth-child(1)')" style="cursor:pointer">Username</th>
        <th onclick="w3.sortHTML('#posts', '.item', 'td:nth-child(2)')" style="cursor:pointer">Writer</th>
        <th onclick="w3.sortHTML('#posts', '.item', 'td:nth-child(3)')" style="cursor:pointer">Admin</th>
        <th onclick="w3.sortHTML('#posts', '.item', 'td:nth-child(4)')" style="cursor:pointer">Block</th>
        <th onclick="w3.sortHTML('#posts', '.item', 'td:nth-child(5)')" style="cursor:pointer">Delete</th>
    </tr>
    @foreach (var user in Model)
    {
        <tr class="item">
            <td><a href="/users/details/@user.Id">@user.ApplicationIdentityUser.UserName</a></td>
            @if (user.ApplicationIdentityUser.Roles.Contains("Writer"))
            {
                <td><input class="writercheckbox" id="writer @user.Id" type="checkbox" checked="checked"/></td>
            }
            else
            {
                <td><input class="writercheckbox" id="writer @user.Id" type="checkbox"/></td>
            }
            @if (user.ApplicationIdentityUser.Roles.Contains("Admin"))
            {
                <td><input class="admincheckbox" id="admin @user.Id" type="checkbox" checked="checked"/></td>
            }
            else
            {
                <td><input class="admincheckbox" id="admin @user.Id" type="checkbox"/></td>
            }
            <td><input class="blockbutton" id="block @user.Id" type="button" value="Block" /></td>
            <td><input class="deletebutton" id="delete @user.Id" type="button" value="Delete" /></td>
        </tr>
    }
</table>

@section Scripts {
    <script>
        $('.writercheckbox').on('change', function(e) {
            e.preventDefault();
            if (this.checked) {
                $.ajax({
                    url: '/users/addwriterpermissions/' + this.id.replace('writer ', ''),
                })
            } else {
                $.ajax({
                    url: '/users/removewriterpermissions/' + this.id.replace('writer ', ''),
                })
            }
        })
    </script>

    <script>
        $('.admincheckbox').on('change', function(e) {
            e.preventDefault();
            if (this.checked) {
                $.ajax({
                    url: '/users/addadminpermissions/' + this.id.replace('admin ', ''),
                })
            } else {
                $.ajax({
                    url: '/users/removeadminpermissions/' + this.id.replace('admin ', ''),
                })
            }
        })
    </script>
}